var e={};e=class{constructor(e){this.size=4,this.score=0,this.status="idle",this.board=e||Array(this.size).fill().map(()=>Array(this.size).fill(0)),this.won=!1}move(e){if("playing"!==this.status)return!1;let t=!1;switch(e){case"left":t=this.moveLeft();break;case"right":t=this.moveRight();break;case"up":t=this.moveUp();break;case"down":t=this.moveDown()}return t&&(this.addNewTile(),this.checkGameStatus()),t}moveLeft(){return this.moveHorizontal("left")}moveRight(){return this.moveHorizontal("right")}moveUp(){return this.moveVertical("up")}moveDown(){return this.moveVertical("down")}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){this.status="playing",this.isBoardEmpty()&&(this.addNewTile(),this.addNewTile())}restart(){this.board=Array(this.size).fill().map(()=>Array(this.size).fill(0)),this.score=0,this.status="playing",this.won=!1,this.addNewTile(),this.addNewTile()}isBoardEmpty(){return this.board.every(e=>e.every(e=>0===e))}getEmptyCells(){let e=[];for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)0===this.board[t][s]&&e.push([t,s]);return e}addNewTile(){let e=this.getEmptyCells();if(e.length){let[t,s]=e[Math.floor(Math.random()*e.length)];this.board[t][s]=.9>Math.random()?2:4}}moveHorizontal(e){let t=!1;for(let s=0;s<this.size;s++){let i="left"===e?this.board[s].filter(e=>0!==e):this.board[s].filter(e=>0!==e).reverse(),r=this.mergeTiles(i),l="left"===e?[...r,...Array(this.size-r.length).fill(0)]:[...Array(this.size-r.length).fill(0),...r.reverse()];JSON.stringify(this.board[s])!==JSON.stringify(l)&&(t=!0),this.board[s]=l}return t}moveVertical(e){let t=!1;for(let s=0;s<this.size;s++){let i=this.board.map(e=>e[s]).filter(e=>0!==e);"down"===e&&i.reverse();let r=this.mergeTiles(i),l="up"===e?[...r,...Array(this.size-r.length).fill(0)]:[...Array(this.size-r.length).fill(0),...r.reverse()];JSON.stringify(this.board.map(e=>e[s]))!==JSON.stringify(l)&&(t=!0);for(let e=0;e<this.size;e++)this.board[e][s]=l[e]}return t}mergeTiles(e){let t=[];for(let s=0;s<e.length;s++)if(s<e.length-1&&e[s]===e[s+1]){let i=2*e[s];t.push(i),this.score+=i,2048!==i||this.won||(this.won=!0,this.status="win"),s++}else t.push(e[s]);return t}checkGameStatus(){if(!this.won&&!(this.getEmptyCells().length>0)){for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){let s=this.board[e][t];for(let[i,r]of[[e-1,t],[e+1,t],[e,t-1],[e,t+1]])if(i>=0&&i<this.size&&r>=0&&r<this.size&&this.board[i][r]===s)return}this.status="lose"}}},document.addEventListener("DOMContentLoaded",()=>{let t=new e,s=document.querySelector(".game-field"),i=document.querySelector(".button"),r=document.querySelector(".message-start"),l=document.querySelector(".message-lose"),o=document.querySelector(".message-win"),a=document.querySelector(".game-score");function h(){let e=t.getState();s.querySelectorAll(".field-cell").forEach((t,s)=>{let i=e[Math.floor(s/4)][s%4];t.className="field-cell",i>0&&t.classList.add(`field-cell--${i}`),t.textContent=i||""}),a.textContent=t.getScore()}function n(){let e=t.getStatus();r.classList.toggle("hidden","idle"!==e),l.classList.toggle("hidden","lose"!==e),o.classList.toggle("hidden","win"!==e),i.classList.toggle("start","idle"===e),i.classList.toggle("restart","idle"!==e),i.textContent="idle"===e?"Start":"Restart"}i.addEventListener("click",()=>{"idle"===t.getStatus()?t.start():t.restart(),h(),n()}),document.addEventListener("keydown",e=>{if("playing"!==t.getStatus())return;let s=!1;switch(e.key){case"ArrowLeft":s=t.move("left");break;case"ArrowRight":s=t.move("right");break;case"ArrowUp":s=t.move("up");break;case"ArrowDown":s=t.move("down")}s&&(h(),n())})});
//# sourceMappingURL=index.7ec778b6.js.map
